/*! owncloud-chat 2014-10-22 */
!function(angular){"use strict";angular.module("bernhardposselt.enhancetext",["ngSanitize"]).provider("enhanceTextFilter",function(){function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var options={cache:!0,newLineToBr:!0,embedLinks:!0,embeddedLinkTarget:"_blank",embedImages:!0,embeddedImagesHeight:void 0,embeddedImagesWidth:void 0,embedVideos:!0,embeddedVideosHeight:void 0,embeddedVideosWidth:void 0,embedYoutube:!0,embeddedYoutubeHeight:void 0,embeddedYoutubeWidth:void 0,smilies:{}},textCache={};this.setOptions=function(customOptions){angular.extend(options,customOptions)};var getDimensionsHtml=function(height,width){var dimensions="";return angular.isDefined(height)&&(dimensions+='height="'+height+'" '),angular.isDefined(width)&&(dimensions+='width="'+width+'" '),dimensions};this.$get=["$sanitize","$sce",function($sanitize,$sce){return function(text){var originalText=text;if(options.cache){var cachedResult=textCache[text];if(angular.isDefined(cachedResult))return cachedResult}text=$sanitize(text);for(var smileyKeys=Object.keys(options.smilies),lines=text.split("&#10;"),smileyReplacer=function(smiley,replacement,line){var startSmiley="^"+escapeRegExp(smiley)+" ",endSmiley=" "+escapeRegExp(smiley)+"$",middleSmiley=" "+escapeRegExp(smiley)+" ",onlySmiley="^"+escapeRegExp(smiley)+"$";return line.replace(new RegExp(startSmiley),replacement+" ").replace(new RegExp(endSmiley)," "+replacement).replace(new RegExp(middleSmiley)," "+replacement+" ").replace(new RegExp(onlySmiley),replacement)},i=0;i<smileyKeys.length;i++){var smiley=smileyKeys[i],replacement='<img alt="'+smiley+'" src="'+options.smilies[smiley]+'"/>',replacer=smileyReplacer.bind(null,smiley,replacement);lines=lines.map(replacer)}if(text=lines.join("&#10;"),options.embedImages){var imgRegex=/((?:https?):\/\/\S*\.(?:gif|jpg|jpeg|tiff|png|svg|webp))/gi,imgDimensions=getDimensionsHtml(options.embeddedImagesHeight,options.embeddedImagesWidth),img='<a href="$1" target="'+options.embeddedLinkTarget+'"><img '+imgDimensions+'alt="image" src="$1"/></a>';text=text.replace(imgRegex,img)}if(options.embedVideos){var vidRegex=/((?:https?):\/\/\S*\.(?:ogv|webm))/gi,vidDimensions=getDimensionsHtml(options.embeddedVideosHeight,options.embeddedVideosWidth),vid="<video "+vidDimensions+'src="$1" controls preload="none"></video>';text=text.replace(vidRegex,vid)}if(options.embedYoutube){var ytRegex=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[?=&+%\w-]*/gi,ytDimensions=getDimensionsHtml(options.embeddedYoutubeHeight,options.embeddedYoutubeWidth),yt="<iframe "+ytDimensions+'src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>';text=text.replace(ytRegex,yt)}if(options.newLineToBr&&(text=text.replace("/\n/g","<br/>").replace(/&#10;/g,"<br/>")),options.embedLinks){var linkRegex=/((href|src)=["']|)(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;text=text.replace(linkRegex,function(){return arguments[1]?arguments[0]:'<a target="'+options.embeddedLinkTarget+'" href="'+arguments[3]+'">'+arguments[3]+"</a>"})}return text=$sce.trustAsHtml(text),options.cache&&(textCache[originalText]=text),text}}]})}(angular,void 0);