/*! owncloud-chat 2014-10-26 */
!function($){function isHostMethod(object,property){var t=typeof object[property];return"function"===t||!("object"!=t||!object[property])||"unknown"==t}function isHostProperty(object,property){return typeof object[property]!=UNDEF}function isHostObject(object,property){return!("object"!=typeof object[property]||!object[property])}function fail(reason){window.console&&window.console.log&&window.console.log("RangyInputs not supported in your browser. Reason: "+reason)}function adjustOffsets(el,start,end){return 0>start&&(start+=el.value.length),typeof end==UNDEF&&(end=start),0>end&&(end+=el.value.length),{start:start,end:end}}function makeSelection(el,start,end){return{start:start,end:end,length:end-start,text:el.value.slice(start,end)}}function getBody(){return isHostObject(document,"body")?document.body:document.getElementsByTagName("body")[0]}var getSelection,setSelection,deleteSelectedText,deleteText,insertText,replaceSelectedText,surroundSelectedText,extractSelectedText,collapseSelection,UNDEF="undefined";$(document).ready(function(){function jQuerify(func,returnThis){return function(){var el=this.jquery?this[0]:this,nodeName=el.nodeName.toLowerCase();if(1==el.nodeType&&("textarea"==nodeName||"input"==nodeName&&/^(?:text|email|number|search|tel|url|password)$/i.test(el.type))){var args=[el].concat(Array.prototype.slice.call(arguments)),result=func.apply(this,args);if(!returnThis)return result}return returnThis?this:void 0}}var testTextArea=document.createElement("textarea");if(getBody().appendChild(testTextArea),isHostProperty(testTextArea,"selectionStart")&&isHostProperty(testTextArea,"selectionEnd"))getSelection=function(el){var start=el.selectionStart,end=el.selectionEnd;return makeSelection(el,start,end)},setSelection=function(el,startOffset,endOffset){var offsets=adjustOffsets(el,startOffset,endOffset);el.selectionStart=offsets.start,el.selectionEnd=offsets.end},collapseSelection=function(el,toStart){toStart?el.selectionEnd=el.selectionStart:el.selectionStart=el.selectionEnd};else{if(!(isHostMethod(testTextArea,"createTextRange")&&isHostObject(document,"selection")&&isHostMethod(document.selection,"createRange")))return getBody().removeChild(testTextArea),void fail("No means of finding text input caret position");getSelection=function(el){var normalizedValue,textInputRange,len,endRange,start=0,end=0,range=document.selection.createRange();return range&&range.parentElement()==el&&(len=el.value.length,normalizedValue=el.value.replace(/\r\n/g,"\n"),textInputRange=el.createTextRange(),textInputRange.moveToBookmark(range.getBookmark()),endRange=el.createTextRange(),endRange.collapse(!1),textInputRange.compareEndPoints("StartToEnd",endRange)>-1?start=end=len:(start=-textInputRange.moveStart("character",-len),start+=normalizedValue.slice(0,start).split("\n").length-1,textInputRange.compareEndPoints("EndToEnd",endRange)>-1?end=len:(end=-textInputRange.moveEnd("character",-len),end+=normalizedValue.slice(0,end).split("\n").length-1))),makeSelection(el,start,end)};var offsetToRangeCharacterMove=function(el,offset){return offset-(el.value.slice(0,offset).split("\r\n").length-1)};setSelection=function(el,startOffset,endOffset){var offsets=adjustOffsets(el,startOffset,endOffset),range=el.createTextRange(),startCharMove=offsetToRangeCharacterMove(el,offsets.start);range.collapse(!0),offsets.start==offsets.end?range.move("character",startCharMove):(range.moveEnd("character",offsetToRangeCharacterMove(el,offsets.end)),range.moveStart("character",startCharMove)),range.select()},collapseSelection=function(el,toStart){var range=document.selection.createRange();range.collapse(toStart),range.select()}}getBody().removeChild(testTextArea),deleteText=function(el,start,end,moveSelection){var val;start!=end&&(val=el.value,el.value=val.slice(0,start)+val.slice(end)),moveSelection&&setSelection(el,start,start)},deleteSelectedText=function(el){var sel=getSelection(el);deleteText(el,sel.start,sel.end,!0)},extractSelectedText=function(el){var val,sel=getSelection(el);return sel.start!=sel.end&&(val=el.value,el.value=val.slice(0,sel.start)+val.slice(sel.end)),setSelection(el,sel.start,sel.start),sel.text};var updateSelectionAfterInsert=function(el,startIndex,text,selectionBehaviour){var endIndex=startIndex+text.length;if(selectionBehaviour="string"==typeof selectionBehaviour?selectionBehaviour.toLowerCase():"",("collapsetoend"==selectionBehaviour||"select"==selectionBehaviour)&&/[\r\n]/.test(text)){var normalizedText=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n");endIndex=startIndex+normalizedText.length;var firstLineBreakIndex=startIndex+normalizedText.indexOf("\n");"\r\n"==el.value.slice(firstLineBreakIndex,firstLineBreakIndex+2)&&(endIndex+=normalizedText.match(/\n/g).length)}switch(selectionBehaviour){case"collapsetostart":setSelection(el,startIndex,startIndex);break;case"collapsetoend":setSelection(el,endIndex,endIndex);break;case"select":setSelection(el,startIndex,endIndex)}};insertText=function(el,text,index,selectionBehaviour){var val=el.value;el.value=val.slice(0,index)+text+val.slice(index),"boolean"==typeof selectionBehaviour&&(selectionBehaviour=selectionBehaviour?"collapseToEnd":""),updateSelectionAfterInsert(el,index,text,selectionBehaviour)},replaceSelectedText=function(el,text,selectionBehaviour){var sel=getSelection(el),val=el.value;el.value=val.slice(0,sel.start)+text+val.slice(sel.end),updateSelectionAfterInsert(el,sel.start,text,selectionBehaviour||"collapseToEnd")},surroundSelectedText=function(el,before,after,selectionBehaviour){typeof after==UNDEF&&(after=before);var sel=getSelection(el),val=el.value;el.value=val.slice(0,sel.start)+before+sel.text+after+val.slice(sel.end);var startIndex=sel.start+before.length;updateSelectionAfterInsert(el,startIndex,sel.text,selectionBehaviour||"select")},$.fn.extend({getSelection:jQuerify(getSelection,!1),setSelection:jQuerify(setSelection,!0),collapseSelection:jQuerify(collapseSelection,!0),deleteSelectedText:jQuerify(deleteSelectedText,!0),deleteText:jQuerify(deleteText,!0),extractSelectedText:jQuerify(extractSelectedText,!1),insertText:jQuerify(insertText,!0),replaceSelectedText:jQuerify(replaceSelectedText,!0),surroundSelectedText:jQuerify(surroundSelectedText,!0)})})}(jQuery);